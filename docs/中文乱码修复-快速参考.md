# 中文乱码修复 - 快速参考

## 问题

接口返回的中文字段出现乱码：`DeepSeekå®˜æ–¹API-ç§æœ‰`

## 解决方案

### 1. 后端配置（已修复）✅

**文件：** `backend/config/db.go`

```go
// DSN 强制使用 utf8mb4
dsn := fmt.Sprintf("%s:%s@tcp(%s:%d)/%s?charset=utf8mb4&collation=utf8mb4_unicode_ci&parseTime=True&loc=Local",
    config.User, config.Password, config.Host, config.Port, config.DBName,
)

// 连接后设置字符集
DB.Exec("SET NAMES utf8mb4 COLLATE utf8mb4_unicode_ci")
```

### 2. 数据修复（已修复）✅

```bash
# 执行迁移脚本
docker exec -i mysql mysql -uroot -p123456 --default-character-set=utf8mb4 context_engine \
  < docker/migrations/003_fix_test_data.sql
```

**重点：** 必须使用 `--default-character-set=utf8mb4` 参数！

### 3. 验证

```bash
# 测试接口
curl -X GET "http://localhost:8080/api/v1/api-provider" -H "Authorization: Bearer TOKEN" | jq '.data.list[].api_remark'
```

**期望输出：**
```
"DeepSeek官方API-私有"
"Ollama本地部署-公开"
```

## 关键点

1. ✅ 数据库和表使用 `utf8mb4` 字符集
2. ✅ 连接字符串包含 `charset=utf8mb4`
3. ✅ 插入数据时使用 `--default-character-set=utf8mb4`
4. ✅ GORM 连接后执行 `SET NAMES utf8mb4`

## 相关文件

- [`backend/config/db.go`](../backend/config/db.go) - 数据库连接配置
- [`docker/migrations/003_fix_test_data.sql`](../docker/migrations/003_fix_test_data.sql) - 数据修复脚本
- [`docs/中文乱码问题修复说明.md`](./中文乱码问题修复说明.md) - 完整说明

---

**状态：** ✅ 已修复并验证通过  
**日期：** 2025-10-23
