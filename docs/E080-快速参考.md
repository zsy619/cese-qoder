# E080-ç™»å½•ç»„ä»¶å¿«é€Ÿå‚è€ƒ

**ç‰ˆæœ¬**: 1.0  
**æ—¥æœŸ**: 2025-10-23

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨ç™»å½•ç»„ä»¶

```typescript
import Login from './components/Login';
import { UserService } from './services';

function MyComponent() {
  const [showLogin, setShowLogin] = useState(false);

  const handleLoginSuccess = () => {
    console.log('ç™»å½•æˆåŠŸ');
    // åˆ·æ–°é¡µé¢æˆ–æ›´æ–°çŠ¶æ€
    window.location.reload();
  };

  return (
    <>
      <button onClick={() => setShowLogin(true)}>ç™»å½•</button>
      
      <Login
        visible={showLogin}
        onClose={() => setShowLogin(false)}
        onSuccess={handleLoginSuccess}
      />
    </>
  );
}
```

---

## ğŸ“‹ æ ¸å¿ƒAPI

### Loginç»„ä»¶

```typescript
interface LoginProps {
  visible: boolean;        // æ˜¯å¦æ˜¾ç¤ºç™»å½•çª—å£
  onClose: () => void;     // å…³é—­çª—å£å›è°ƒ
  onSuccess?: () => void;  // ç™»å½•æˆåŠŸå›è°ƒ
}
```

### UserServiceæ–¹æ³•

```typescript
// ç™»å½•
await UserService.login({ mobile, password });

// ç™»å‡º
UserService.logout();

// æ£€æŸ¥ç™»å½•çŠ¶æ€
const isLoggedIn = UserService.isLoggedIn();

// è·å–å½“å‰ç”¨æˆ·æ‰‹æœºå·
const mobile = UserService.getCurrentMobile();

// è·å–å½“å‰ç”¨æˆ·ID
const userId = UserService.getCurrentUserId();
```

---

## ğŸ¨ ç»„ä»¶æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `/components/Login.tsx` | ç™»å½•ç»„ä»¶ |
| `/styles/login.css` | ç™»å½•æ ·å¼ |
| `/pages/MyTemplate.tsx` | æˆ‘çš„æ¨¡æ¿é¡µé¢ |
| `/styles/mytemplate.css` | æˆ‘çš„æ¨¡æ¿æ ·å¼ |
| `/components/Header.tsx` | Headerç»„ä»¶ï¼ˆå·²æ›´æ–°ï¼‰ |
| `/pages/TemplatePage.tsx` | æ¨¡æ¿é¡µé¢ï¼ˆå·²æ›´æ–°ï¼‰ |

---

## ğŸ”‘ å…³é”®åŠŸèƒ½

### 1. ç™»å½•æ£€æŸ¥æ¨¡å¼

```typescript
// åœ¨åŠŸèƒ½æ‰§è¡Œå‰æ£€æŸ¥ç™»å½•çŠ¶æ€
const handleSaveTemplate = () => {
  if (!UserService.isLoggedIn()) {
    showToast('è¯·å…ˆç™»å½•', 'warning');
    setShowLogin(true);
    return;
  }
  // æ‰§è¡Œä¿å­˜é€»è¾‘
};
```

### 2. ç™»å½•çŠ¶æ€ç›‘å¬

```typescript
useEffect(() => {
  // æ£€æŸ¥ç™»å½•çŠ¶æ€
  const isLoggedIn = UserService.isLoggedIn();
  
  // ç›‘å¬ç™»å‡ºäº‹ä»¶
  const handleLogout = () => {
    // æ›´æ–°UIçŠ¶æ€
  };
  
  window.addEventListener('user:logout', handleLogout);
  
  return () => {
    window.removeEventListener('user:logout', handleLogout);
  };
}, []);
```

### 3. é€€å‡ºç™»å½•

```typescript
const handleLogout = () => {
  if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
    UserService.logout();
    navigate('/');
    window.location.reload();
  }
};
```

---

## ğŸ¯ è·¯ç”±é…ç½®

```typescript
<Routes>
  <Route path="/" element={<HomePage />} />
  <Route path="/template" element={<TemplatePage />} />
  <Route path="/my-template" element={<MyTemplate />} />
</Routes>
```

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šåœ¨Headerä¸­é›†æˆç™»å½•

```typescript
// Header.tsx
const [showLogin, setShowLogin] = useState(false);
const [isLoggedIn, setIsLoggedIn] = useState(false);

return (
  <>
    <header>
      {isLoggedIn ? (
        <button onClick={handleLogout}>é€€å‡ºç™»å½•</button>
      ) : (
        <button onClick={() => setShowLogin(true)}>ç™»å½•</button>
      )}
    </header>
    
    <Login
      visible={showLogin}
      onClose={() => setShowLogin(false)}
      onSuccess={() => window.location.reload()}
    />
  </>
);
```

### åœºæ™¯2ï¼šéœ€è¦ç™»å½•çš„åŠŸèƒ½

```typescript
// ä¿å­˜æ¨¡æ¿
const handleSave = () => {
  if (!UserService.isLoggedIn()) {
    setShowLogin(true);
    return;
  }
  // æ‰§è¡Œä¿å­˜
};
```

### åœºæ™¯3ï¼šå—ä¿æŠ¤çš„é¡µé¢

```typescript
// MyTemplate.tsx
useEffect(() => {
  if (!UserService.isLoggedIn()) {
    alert('è¯·å…ˆç™»å½•');
    navigate('/');
  }
}, []);
```

---

## ğŸ¨ æ ·å¼è‡ªå®šä¹‰

### ä¿®æ”¹ä¸»é¢˜è‰²

```css
/* login.css */
.login-header {
  background: linear-gradient(135deg, #YOUR_COLOR 0%, #YOUR_COLOR2 100%);
}

.login-submit-button {
  background: linear-gradient(135deg, #YOUR_COLOR 0%, #YOUR_COLOR2 100%);
}
```

### ä¿®æ”¹æŒ‰é’®æ ·å¼

```css
/* app.css */
.login-btn {
  background-color: #YOUR_COLOR;
}

.logout-btn {
  border-color: #YOUR_COLOR;
  color: #YOUR_COLOR;
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: ç™»å½•åé¡µé¢æ²¡æœ‰åˆ·æ–°ï¼Ÿ

```typescript
// ç¡®ä¿åœ¨onSuccessä¸­åˆ·æ–°é¡µé¢
const handleLoginSuccess = () => {
  window.location.reload();
};
```

### Q2: Tokenä¸¢å¤±æˆ–è¿‡æœŸï¼Ÿ

```typescript
// UserServiceä¼šè‡ªåŠ¨å¤„ç†Tokenè¿‡æœŸ
// ç›‘å¬auth:expiredäº‹ä»¶
window.addEventListener('auth:expired', () => {
  setShowLogin(true);
});
```

### Q3: ç™»å½•å¼¹çª—æ— æ³•å…³é—­ï¼Ÿ

```typescript
// ç¡®ä¿æ­£ç¡®ä¼ é€’onCloseå›è°ƒ
<Login
  visible={showLogin}
  onClose={() => setShowLogin(false)}
/>
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

### ç§»åŠ¨ç«¯é€‚é…

```css
@media (max-width: 480px) {
  .login-content {
    width: 95%;
  }
  
  .login-input {
    font-size: 14px;
  }
}
```

---

## ğŸ”’ å®‰å…¨æç¤º

1. **å¯†ç è¦æ±‚**ï¼š8-16ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
2. **æ‰‹æœºå·æ ¼å¼**ï¼š1[3-9]\d{9}
3. **Tokenç®¡ç†**ï¼šè‡ªåŠ¨ä¿å­˜åˆ°localStorage
4. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS

---

## ğŸ“ å¿«é€Ÿé“¾æ¥

- [å®Œæ•´å®æ–½æ€»ç»“](/docs/E080-å®æ–½æ€»ç»“.md)
- [ç”¨æˆ·æœåŠ¡æ–‡æ¡£](/frontend/src/services/README.md)
- [APIæ–‡æ¡£](/backend/docs/API.md)

---

**æ›´æ–°æ—¶é—´**: 2025-10-23  
**ç»´æŠ¤è€…**: AI React+TypeScriptå·¥ç¨‹å¸ˆ
