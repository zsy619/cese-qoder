# E080-登录组件快速参考

**版本**: 1.0  
**日期**: 2025-10-23

---

## 🚀 快速开始

### 使用登录组件

```typescript
import Login from './components/Login';
import { UserService } from './services';

function MyComponent() {
  const [showLogin, setShowLogin] = useState(false);

  const handleLoginSuccess = () => {
    console.log('登录成功');
    // 刷新页面或更新状态
    window.location.reload();
  };

  return (
    <>
      <button onClick={() => setShowLogin(true)}>登录</button>
      
      <Login
        visible={showLogin}
        onClose={() => setShowLogin(false)}
        onSuccess={handleLoginSuccess}
      />
    </>
  );
}
```

---

## 📋 核心API

### Login组件

```typescript
interface LoginProps {
  visible: boolean;        // 是否显示登录窗口
  onClose: () => void;     // 关闭窗口回调
  onSuccess?: () => void;  // 登录成功回调
}
```

### UserService方法

```typescript
// 登录
await UserService.login({ mobile, password });

// 登出
UserService.logout();

// 检查登录状态
const isLoggedIn = UserService.isLoggedIn();

// 获取当前用户手机号
const mobile = UserService.getCurrentMobile();

// 获取当前用户ID
const userId = UserService.getCurrentUserId();
```

---

## 🎨 组件文件清单

| 文件 | 说明 |
|------|------|
| `/components/Login.tsx` | 登录组件 |
| `/styles/login.css` | 登录样式 |
| `/pages/MyTemplate.tsx` | 我的模板页面 |
| `/styles/mytemplate.css` | 我的模板样式 |
| `/components/Header.tsx` | Header组件（已更新） |
| `/pages/TemplatePage.tsx` | 模板页面（已更新） |

---

## 🔑 关键功能

### 1. 登录检查模式

```typescript
// 在功能执行前检查登录状态
const handleSaveTemplate = () => {
  if (!UserService.isLoggedIn()) {
    showToast('请先登录', 'warning');
    setShowLogin(true);
    return;
  }
  // 执行保存逻辑
};
```

### 2. 登录状态监听

```typescript
useEffect(() => {
  // 检查登录状态
  const isLoggedIn = UserService.isLoggedIn();
  
  // 监听登出事件
  const handleLogout = () => {
    // 更新UI状态
  };
  
  window.addEventListener('user:logout', handleLogout);
  
  return () => {
    window.removeEventListener('user:logout', handleLogout);
  };
}, []);
```

### 3. 退出登录

```typescript
const handleLogout = () => {
  if (confirm('确定要退出登录吗？')) {
    UserService.logout();
    navigate('/');
    window.location.reload();
  }
};
```

---

## 🎯 路由配置

```typescript
<Routes>
  <Route path="/" element={<HomePage />} />
  <Route path="/template" element={<TemplatePage />} />
  <Route path="/my-template" element={<MyTemplate />} />
</Routes>
```

---

## 💡 使用场景

### 场景1：在Header中集成登录

```typescript
// Header.tsx
const [showLogin, setShowLogin] = useState(false);
const [isLoggedIn, setIsLoggedIn] = useState(false);

return (
  <>
    <header>
      {isLoggedIn ? (
        <button onClick={handleLogout}>退出登录</button>
      ) : (
        <button onClick={() => setShowLogin(true)}>登录</button>
      )}
    </header>
    
    <Login
      visible={showLogin}
      onClose={() => setShowLogin(false)}
      onSuccess={() => window.location.reload()}
    />
  </>
);
```

### 场景2：需要登录的功能

```typescript
// 保存模板
const handleSave = () => {
  if (!UserService.isLoggedIn()) {
    setShowLogin(true);
    return;
  }
  // 执行保存
};
```

### 场景3：受保护的页面

```typescript
// MyTemplate.tsx
useEffect(() => {
  if (!UserService.isLoggedIn()) {
    alert('请先登录');
    navigate('/');
  }
}, []);
```

---

## 🎨 样式自定义

### 修改主题色

```css
/* login.css */
.login-header {
  background: linear-gradient(135deg, #YOUR_COLOR 0%, #YOUR_COLOR2 100%);
}

.login-submit-button {
  background: linear-gradient(135deg, #YOUR_COLOR 0%, #YOUR_COLOR2 100%);
}
```

### 修改按钮样式

```css
/* app.css */
.login-btn {
  background-color: #YOUR_COLOR;
}

.logout-btn {
  border-color: #YOUR_COLOR;
  color: #YOUR_COLOR;
}
```

---

## 🐛 常见问题

### Q1: 登录后页面没有刷新？

```typescript
// 确保在onSuccess中刷新页面
const handleLoginSuccess = () => {
  window.location.reload();
};
```

### Q2: Token丢失或过期？

```typescript
// UserService会自动处理Token过期
// 监听auth:expired事件
window.addEventListener('auth:expired', () => {
  setShowLogin(true);
});
```

### Q3: 登录弹窗无法关闭？

```typescript
// 确保正确传递onClose回调
<Login
  visible={showLogin}
  onClose={() => setShowLogin(false)}
/>
```

---

## 📱 响应式设计

### 移动端适配

```css
@media (max-width: 480px) {
  .login-content {
    width: 95%;
  }
  
  .login-input {
    font-size: 14px;
  }
}
```

---

## 🔒 安全提示

1. **密码要求**：8-16位，包含大小写字母、数字和特殊字符
2. **手机号格式**：1[3-9]\d{9}
3. **Token管理**：自动保存到localStorage
4. **HTTPS**：生产环境必须使用HTTPS

---

## 📞 快速链接

- [完整实施总结](/docs/E080-实施总结.md)
- [用户服务文档](/frontend/src/services/README.md)
- [API文档](/backend/docs/API.md)

---

**更新时间**: 2025-10-23  
**维护者**: AI React+TypeScript工程师
