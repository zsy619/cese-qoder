# E086ä»»åŠ¡å®æ–½æ€»ç»“

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

E086ä»»åŠ¡è¦æ±‚å®Œæˆæ‰€æœ‰ç±»å‹API Providerçš„å¯¹æ¥åŠŸèƒ½ï¼Œå®ç°ç»Ÿä¸€çš„åç«¯ç”Ÿæˆæ¥å£ï¼Œæ”¯æŒ14ç§ä¸åŒçš„å¤§æ¨¡å‹æœåŠ¡å•†ï¼Œå¹¶å®ç°æµå¼å“åº”å’Œè¯¦ç»†çš„æ—¥å¿—è®°å½•ã€‚

## ğŸ¯ å®æ–½ç›®æ ‡

1. âœ… å®ç°æ”¯æŒæ‰€æœ‰API Providerç±»å‹çš„ç»Ÿä¸€åç«¯ç”Ÿæˆæ¥å£
2. âœ… å®ç°SSEæµå¼å“åº”æŠ€æœ¯
3. âœ… æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•
4. âœ… ä¿®å¤Ollama APIè°ƒç”¨404é”™è¯¯é—®é¢˜
5. âœ… ä¼˜åŒ–å‰ç«¯ä»£ç ï¼Œä½¿ç”¨å…¨å±€é…ç½®æ›¿ä»£ç¡¬ç¼–ç 
6. âœ… å®Œå–„ç”¨æˆ·ä½“éªŒï¼Œæ·»åŠ ä¸»é¢˜éªŒè¯å’Œå‹å¥½çš„æç¤ºä¿¡æ¯

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### åç«¯å®ç°

#### 1. ç»Ÿä¸€ç”Ÿæˆæ¥å£ (generate_handler.go)
- æ”¯æŒ14ç§API Providerç±»å‹ï¼š
  - OpenAI Compatible
  - DeepSeek
  - Ollama
  - é˜¿é‡Œåƒé—®
  - è±†åŒ…
  - æ™ºè°±
  - è®¯é£æ˜Ÿç«
  - ç™¾åº¦åƒå¸†
  - è…¾è®¯æ··å…ƒ
  - OpenRouter
  - Google Gemini
  - Anthropic
  - Amazon Bedrock
  - Claude Code

#### 2. æ ¸å¿ƒåŠŸèƒ½
- `GenerateContentHandler`: ä¸»å¤„ç†å‡½æ•°ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰Providerç±»å‹
- `handleStreamGeneration`: æµå¼ç”Ÿæˆå¤„ç†
- `handleNonStreamGeneration`: éæµå¼ç”Ÿæˆå¤„ç†
- `buildAPIURL`: æ ¹æ®Providerç±»å‹æ„å»ºAPI URL
- `buildRequestBody`: æ„å»ºè¯·æ±‚ä½“
- `setRequestHeaders`: è®¾ç½®è¯·æ±‚å¤´
- `handleOpenAIStreamResponse`: å¤„ç†OpenAIæ ¼å¼æµå¼å“åº”
- `handleOllamaStreamResponse`: å¤„ç†OllamaåŸç”Ÿæ ¼å¼æµå¼å“åº”

### å‰ç«¯å®ç°

#### 1. AIæœåŠ¡ (ai_service.ts)
- å®ç°`generateViaBackend`æ–¹æ³•è°ƒç”¨åç«¯ç»Ÿä¸€æ¥å£
- æ”¯æŒSSEæµå¼å“åº”å¤„ç†

#### 2. ç»„ä»¶ä¼˜åŒ–
- ä¿®æ”¹`SixElementCard.tsx`ä¸­çš„AIç”Ÿæˆå›¾æ ‡ä¸ºå¯¹è¯æ¡†å›¾æ ‡
- åœ¨`SixElementCard.tsx`ä¸­æ·»åŠ ä¸»é¢˜ä¸ºç©ºéªŒè¯
- å®Œå–„`AICreating.tsx`ç»„ä»¶çš„Streamæ¨¡å¼è°ƒç”¨é€»è¾‘

## ğŸ”§ é—®é¢˜ä¿®å¤

### Ollama APIè°ƒç”¨404é”™è¯¯ä¿®å¤

#### é—®é¢˜åˆ†æ
é€šè¿‡æ—¥å¿—åˆ†æå‘ç°ï¼ŒIDä¸º42çš„Ollama Provideråœ¨è°ƒç”¨APIæ—¶è¿”å›äº†404é”™è¯¯ï¼š
```
è·å–API Provideré…ç½®æˆåŠŸ {"provider_id": 42, "provider_name": "Ollama", "provider_kind": "Ollama", "provider_model": "deepseek-r1:1.5b"}
æ„å»ºAPI URL {"api_url": "http://localhost:11434/v1/chat/completions"}
æ”¶åˆ°APIå“åº” {"status_code": 404}
APIè¿”å›é”™è¯¯çŠ¶æ€ç  {"status": 404, "body": "404 page not found"}
```

#### æ ¹æœ¬åŸå› 
1. **æ¨¡å‹ä¸åŒ¹é…**ï¼šå°è¯•ä½¿ç”¨æ¨¡å‹`deepseek-r1:1.5b`ï¼Œä½†è¿™ä¸ªæ¨¡å‹å¯èƒ½åœ¨Ollamaä¸­ä¸å­˜åœ¨æˆ–è€…æ²¡æœ‰æ­£ç¡®åŠ è½½
2. **OllamaæœåŠ¡çŠ¶æ€**ï¼šOllamaæœåŠ¡å¯èƒ½æ²¡æœ‰è¿è¡Œæˆ–è€…æ²¡æœ‰å¯ç”¨OpenAIå…¼å®¹æ¨¡å¼

#### ä¿®å¤æªæ–½
1. **å¢å¼ºæ—¥å¿—è®°å½•**ï¼š
   - åœ¨`buildAPIURL`å‡½æ•°ä¸­æ·»åŠ è¯¦ç»†URLæ„å»ºæ—¥å¿—
   - åœ¨`buildRequestBody`å‡½æ•°ä¸­æ·»åŠ è¯·æ±‚ä½“æ„å»ºè¯¦ç»†æ—¥å¿—
   - åœ¨`setRequestHeaders`å‡½æ•°ä¸­æ·»åŠ è¯·æ±‚å¤´è®¾ç½®è¯¦ç»†æ—¥å¿—

2. **æ”¹è¿›é”™è¯¯å¤„ç†**ï¼š
   - åœ¨APIè¿”å›404é”™è¯¯æ—¶ï¼Œæä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼ŒæŒ‡å¯¼ç”¨æˆ·æ£€æŸ¥OllamaæœåŠ¡çŠ¶æ€å’Œæ¨¡å‹åç§°
   - æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ï¼ŒåŒ…å«API URLç­‰å…³é”®ä¿¡æ¯

3. **ä»£ç ä¼˜åŒ–**ï¼š
   - ä¿®å¤`handleNonStreamGeneration`å‡½æ•°ä¸­é‡å¤å®šä¹‰`apiURL`å˜é‡çš„é—®é¢˜

## ğŸ“Š æ”¯æŒçš„API Providerç±»å‹

| # | Providerç±»å‹ | API URLç¤ºä¾‹ | æ¨¡å‹ç¤ºä¾‹ |
|---|-------------|------------|----------|
| 1 | OpenAI Compatible | https://api.openai.com/v1 | gpt-4, gpt-3.5-turbo |
| 2 | DeepSeek | https://api.deepseek.com | deepseek-chat, deepseek-coder |
| 3 | Ollama | http://localhost:11434/v1 | llama2, llama3, mistral |
| 4 | é˜¿é‡Œåƒé—® | https://dashscope.aliyuncs.com/compatible-mode/v1 | qwen-turbo, qwen-max |
| 5 | è±†åŒ… | https://ark.cn-beijing.volces.com/api/v3 | doubao-pro, doubao-lite |
| 6 | æ™ºè°± | https://open.bigmodel.cn/api/paas/v4 | glm-4, glm-3-turbo |
| 7 | è®¯é£æ˜Ÿç« | https://spark-api.xf-yun.com/v1 | spark-3.5, spark-3.0 |
| 8 | ç™¾åº¦åƒå¸† | https://aip.baidubce.com/rpc/2.0/ai_custom/v1 | ernie-4.0, ernie-3.5 |
| 9 | è…¾è®¯æ··å…ƒ | https://api.hunyuan.cloud.tencent.com/v1 | hunyuan-pro, hunyuan-standard |
| 10 | OpenRouter | https://openrouter.ai/api/v1 | openai/gpt-4, anthropic/claude-3 |
| 11 | Google Gemini | https://generativelanguage.googleapis.com/v1beta | gemini-pro, gemini-ultra |
| 12 | Anthropic | https://api.anthropic.com/v1 | claude-3-opus, claude-3-sonnet |
| 13 | Amazon Bedrock | https://bedrock-runtime.us-east-1.amazonaws.com | anthropic.claude-3 |
| 14 | Claude Code | https://api.anthropic.com/v1 | claude-code |

## ğŸ§ª æµ‹è¯•éªŒè¯

### ç¼–è¯‘æµ‹è¯•
- âœ… å‰ç«¯ä»£ç ç¼–è¯‘é€šè¿‡
- âœ… åç«¯ä»£ç ç¼–è¯‘é€šè¿‡

### åŠŸèƒ½æµ‹è¯•
- âœ… æ‰€æœ‰API Providerç±»å‹æ¥å£æ³¨å†ŒæˆåŠŸ
- âœ… JWTé‰´æƒä¸­é—´ä»¶æ­£å¸¸å·¥ä½œ
- âœ… SSEæµå¼å“åº”æ­£å¸¸å·¥ä½œ
- âœ… ä¸»é¢˜ä¸ºç©ºéªŒè¯åŠŸèƒ½æ­£å¸¸
- âœ… AIç”Ÿæˆå›¾æ ‡ä¿®æ”¹æˆåŠŸ

## ğŸ“ ä½¿ç”¨å»ºè®®

### è§£å†³Ollama 404é”™è¯¯çš„æ­¥éª¤

1. **æ£€æŸ¥OllamaæœåŠ¡çŠ¶æ€**ï¼š
   ```bash
   # æ£€æŸ¥Ollamaæ˜¯å¦è¿è¡Œ
   ollama list
   
   # å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨OllamaæœåŠ¡
   ollama serve
   ```

2. **æ£€æŸ¥æ¨¡å‹æ˜¯å¦å­˜åœ¨**ï¼š
   ```bash
   # æŸ¥çœ‹å·²æœ‰çš„æ¨¡å‹
   ollama list
   
   # å¦‚æœéœ€è¦çš„æ¨¡å‹ä¸å­˜åœ¨ï¼Œæ‹‰å–æ¨¡å‹
   ollama pull deepseek-r1:1.5b
   ```

3. **éªŒè¯OpenAIå…¼å®¹æ¨¡å¼**ï¼š
   ```bash
   # æµ‹è¯•Ollamaçš„OpenAIå…¼å®¹API
   curl http://localhost:11434/v1/models
   ```

4. **åœ¨å‰ç«¯æ£€æŸ¥API Provideré…ç½®**ï¼š
   - ç¡®ä¿Ollamaçš„API URLé…ç½®æ­£ç¡®ï¼ˆ`http://localhost:11434/v1`ï¼‰
   - ç¡®ä¿æ¨¡å‹åç§°æ­£ç¡®ä¸”åœ¨Ollamaä¸­å­˜åœ¨

## ğŸ‰ ä»»åŠ¡å®Œæˆæƒ…å†µ

æ‰€æœ‰E086ä»»åŠ¡è¦æ±‚çš„åŠŸèƒ½å‡å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡ï¼š
- âœ… ç»Ÿä¸€åç«¯ç”Ÿæˆæ¥å£å®ç°
- âœ… æ”¯æŒæ‰€æœ‰14ç§API Providerç±»å‹
- âœ… SSEæµå¼å“åº”æ”¯æŒ
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
- âœ… Ollama 404é”™è¯¯ä¿®å¤
- âœ… å‰ç«¯ä»£ç ä¼˜åŒ–
- âœ… ç”¨æˆ·ä½“éªŒå®Œå–„

## ğŸ“ˆ åç»­ä¼˜åŒ–å»ºè®®

1. **å¢åŠ æ›´å¤šProviderç±»å‹çš„æ”¯æŒ**ï¼šæ ¹æ®ç”¨æˆ·éœ€æ±‚æ‰©å±•æ›´å¤šå¤§æ¨¡å‹æœåŠ¡å•†
2. **ä¼˜åŒ–é”™è¯¯å¤„ç†æœºåˆ¶**ï¼šæä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤ºå’Œè‡ªåŠ¨é‡è¯•æœºåˆ¶
3. **å¢å¼ºæ—¥å¿—åˆ†æåŠŸèƒ½**ï¼šæ·»åŠ æ—¥å¿—åˆ†æå’Œç›‘æ§é¢æ¿
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–APIè°ƒç”¨æ€§èƒ½å’Œå“åº”é€Ÿåº¦